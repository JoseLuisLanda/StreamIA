/* Main App Container */
.app-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: #000;
    font-family: 'Inter', 'Outfit', sans-serif;
}

/* Avatar Wrapper - Desktop Behavior */
.avatar-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    transition: left 0.3s cubic-bezier(0.2, 0, 0.2, 1), width 0.3s cubic-bezier(0.2, 0, 0.2, 1);
    z-index: 1;
    /* Base level */
}

/* Desktop: Push content when panel opens */
.avatar-wrapper.panel-open {
    left: 340px;
    width: calc(100% - 340px);
}

/* Overlays Container */
.overlays-container {
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 20px;
    z-index: 100;
    pointer-events: none;
}

.overlays-container>* {
    pointer-events: auto;
}

/* Side Panel - Desktop */
.side-panel {
    position: fixed;
    left: -340px;
    top: 0;
    width: 340px;
    height: 100vh;
    background: #0B0F19;
    z-index: 1500;
    transition: left 0.3s cubic-bezier(0.2, 0, 0.2, 1), box-shadow 0.3s ease;
    overflow-y: auto;
    overflow-x: hidden;
    border-right: 1px solid #1F2436;
    box-shadow: 5px 0 20px rgba(0, 0, 0, 0.5);
}

.side-panel::-webkit-scrollbar {
    width: 6px;
}

.side-panel::-webkit-scrollbar-thumb {
    background: #2A3042;
    border-radius: 10px;
}

.side-panel::-webkit-scrollbar-track {
    background: #0B0F19;
}

.side-panel.open {
    left: 0;
}

.panel-content {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

/* Panel Title */
.panel-title {
    margin: 0.5rem 0 1rem 0;
    color: #fff;
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    letter-spacing: -0.01em;
}

.panel-title::before {
    content: '';
    width: 24px;
    height: 24px;
    background: linear-gradient(135deg, #FF3BFF, #5C24FF);
    border-radius: 6px;
    display: inline-block;
}

/* Panel Toggle Button */
.panel-toggle {
    position: fixed;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2000;
    width: 20px;
    height: 40px;
    background: #0B0F19;
    border: 1px solid #1F2436;
    border-left: none;
    border-radius: 0 6px 6px 0;
    color: #9CA3AF;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.panel-toggle:hover {
    background: #151926;
    color: #fff;
    width: 28px;
}

.panel-toggle.panel-open {
    left: 340px;
}

/* Accordion Styling */
.accordion-item {
    background: #10141E;
    border: 1px solid #23293D;
    border-radius: 10px;
    overflow: hidden;
    transition: border-color 0.2s ease;
    margin-bottom: 0.5rem;
}

.accordion-item:hover {
    border-color: #3B4259;
}

.accordion-item.open {
    border-color: #5C24FF;
    background: #131724;
}

.accordion-header {
    padding: 0.85rem 1rem;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: transparent;
    transition: background 0.2s;
}

.accordion-header:hover {
    background: rgba(255, 255, 255, 0.02);
}

.accordion-title {
    font-weight: 500;
    color: #E2E8F0;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
}

.accordion-chevron {
    color: #64748B;
    font-size: 0.7rem;
    transition: transform 0.3s ease, color 0.3s ease;
}

.accordion-item.open .accordion-title {
    color: #fff;
    text-shadow: 0 0 20px rgba(92, 36, 255, 0.3);
}

.accordion-item.open .accordion-chevron {
    transform: rotate(180deg);
    color: #5C24FF;
}

.accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s cubic-bezier(0.2, 0, 0.2, 1), opacity 0.3s ease;
    opacity: 0;
    background: #0B0F19;
}

.accordion-item.open .accordion-content {
    max-height: 2000px;
    /* Allow content to flow downwards */
    opacity: 1;
    padding: 1rem;
    border-top: 1px solid #1F2436;
}

/* Camera Preview */
.camera-container {
    position: relative;
    width: 100%;
    height: 180px;
    border-radius: 8px;
    overflow: hidden;
    background: #000;
    border: 1px solid #23293D;
}

/* Back Button */
.back-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    border-radius: 8px;
    background: transparent;
    color: #9CA3AF;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.85rem;
    transition: all 0.2s;
    border: 1px solid transparent;
    margin-top: 1rem;
}

.back-btn:hover {
    color: #fff;
    background: #151926;
    border-color: #23293D;
}

/* Loading Overlay */
.loading-scene-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(11, 15, 25, 0.95);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.loading-scene-overlay.visible {
    opacity: 1;
    pointer-events: all;
}

.loading-spinner {
    width: 32px;
    height: 32px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-top-color: #5C24FF;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-bottom: 16px;
}

.loading-text {
    color: #fff;
    font-size: 0.85rem;
    font-weight: 500;
    letter-spacing: 0.5px;
    background: linear-gradient(90deg, #A855F7, #5C24FF);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* ==========================================================================
   RESPONSIVE QUERIES (Mobile/Tablet)
   ========================================================================== */
@media (max-width: 768px) {

    /* Avatar - Full Screen Behind Panel */
    .avatar-wrapper.panel-open {
        left: 0;
        width: 100%;
        /* Do NOT shrink avatar on mobile, let panel overlay */
    }

    /* Side Panel - Overlay Drawer */
    .side-panel {
        width: 85%;
        max-width: 320px;
        box-shadow: 10px 0 50px rgba(0, 0, 0, 0.8);
        border-right: 1px solid #1F2436;
    }

    /* Panel toggle follows the sidebar edge */
    .panel-toggle.panel-open {
        left: 85%;
        left: calc(85% - 1px);
        background: #151926;
    }

    @media (min-width: 380px) {
        .panel-toggle.panel-open {
            left: 320px;
        }
    }

    /* Add backdrop when panel is open */
    .side-panel.open::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
        z-index: -1;
        pointer-events: none;
    }

    .panel-content {
        padding: 1rem;
    }

    .accordion-header {
        padding: 1rem;
    }

    /* --- MOBILE OVERLAYS OPTIMIZATION --- */
    .overlays-container {
        top: 60px;
        /* Start below header */
        width: 100%;
        padding: 0 16px;
        /* Use Flexbox for perfect centering of the single allowed screen */
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        pointer-events: none;
        /* Ensure it doesn't expand infinitely down covering face */
        max-height: 40vh;
        overflow: hidden;
    }

    /* Force Media Overlay to be responsive and stacked */
    /* We use ::ng-deep to override the component's internal inline styles and cdkDrag positioning */
    ::ng-deep app-media-overlay {
        position: relative !important;
        /* Disable absolute free-move on mobile */
        transform: translate3d(0, 0, 0) !important;
        /* Reset drag transforms */
        width: auto !important;
        /* Allow auto width but constrained by max-width */
        max-width: 90vw !important;
        height: auto !important;
        pointer-events: auto;
        display: flex;
        justify-content: center;
        margin: 0 auto !important;
        /* Auto margins for centering */
    }

    ::ng-deep app-media-overlay .media-content,
    ::ng-deep app-media-overlay .overlay-card {
        width: 100% !important;
        min-width: 250px;
        /* Minimum width to be usable */
        height: auto !important;
        aspect-ratio: 16/9;
        /* Force a standard ratio or use object-fit */
        max-height: 120px !important;
        /* Cap height to keep avatar visible */
    }

    /* Fix: Always show controls bar on mobile (touch devices don't have hover) */
    ::ng-deep app-media-overlay .controls-bar {
        /* On mobile we might want it visible or just rely on tap? 
           User moved functionality to sidebar. 
           Let's keep it clean but accessible if they really want close there too. 
           But remove red debugs. */
        /* opacity: 1 !important; -> Maybe revert to hover if sidebar is primary? 
           But user said "sigo sin poder eliminarla" before moving to sidebar.
           Now that sidebar handles it, we can relax this or keep it subtle. */
        opacity: 0;
        transition: opacity 0.2s;
    }

    ::ng-deep app-media-overlay.active .controls-bar,
    ::ng-deep app-media-overlay:active .controls-bar {
        opacity: 1 !important;
    }

    @media (hover: none) {
        ::ng-deep app-media-overlay .controls-bar {
            opacity: 1;
            /* Keep visible on touch to show play/pause */
            background: rgba(0, 0, 0, 0.5);
        }
    }

    /* Ensure buttons inside are interactable */
    ::ng-deep app-media-overlay .control-btn,
    ::ng-deep app-media-overlay .close-btn {
        pointer-events: auto !important;
        width: 32px !important;
        height: 32px !important;
    }
}

/* Small Phones */
@media (max-width: 380px) {
    .side-panel {
        width: 100%;
        border-right: none;
    }

    .panel-toggle.panel-open {
        left: auto;
        right: 0;
        border-radius: 6px 0 0 6px;
        border-left: 1px solid #1F2436;
        border-right: none;
    }

    .overlays-container>* {
        transform: scale(0.55);
        /* Smaller scale for tiny screens */
    }
}